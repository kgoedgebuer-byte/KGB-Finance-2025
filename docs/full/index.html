<!doctype html>
<html lang="nl">
<head>
  <script src="../common/year_partition.js?v=1764956526"></script>
  <link rel="icon" href="/KGB-Finance-2025/icons/kgb-blue-v2.svg" type="image/svg+xml" sizes="any">
  <meta name="theme-color" content="#2F7CFB"><link rel="stylesheet" href="styles.css">











<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>KGB Finance 2025 â€” Web (Full)</title>
  <link rel="manifest" href="manifest.webmanifest"><script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
<script id="kgb-web-safeload">
(function(){
  if (window.__KGB_SAFELOAD__) return; window.__KGB_SAFELOAD__=true;

  // 1) Rood foutbanner bij JS-fouten
  function banner(msg){
    try{
      var n=document.createElement('div');
      n.style.cssText='position:fixed;left:10px;right:10px;bottom:10px;z-index:2147483647;background:#7b1111;color:#fff;padding:10px 12px;border-radius:10px;font:13px/1.3 -apple-system,Segoe UI,Arial;box-shadow:0 8px 28px rgba(0,0,0,.3)';
      n.textContent='FOUT: '+msg;
      document.body.appendChild(n);
      setTimeout(()=>{ try{ n.remove(); }catch(_){ } }, 8000);
    }catch(_){}
  }
  window.addEventListener('error', e=>banner(e.message||'onbekend'));
  window.addEventListener('unhandledrejection', e=>banner((e.reason&&e.reason.message)||String(e.reason||'Promise error')));

  // 2) Fetch wrap: geef veilige defaults voor data JSONs
  const origFetch = window.fetch ? window.fetch.bind(window) : null;
  function isDataJson(u){
    try{
      const url = (typeof u==='string') ? new URL(u, location.href) : new URL(u.url||u, location.href);
      return /\/data\/.*\.json(\?|$)/i.test(url.pathname + url.search);
    }catch(_){ return false; }
  }
  async function safeJsonResponse(body){
    return new Response(typeof body==='string' ? body : JSON.stringify(body), {
      status: 200, headers: { 'Content-Type': 'application/json' }
    });
  }
  if (origFetch){
    window.fetch = async function(input, init){
      try{
        const res = await origFetch(input, init);
        if (!res.ok && isDataJson(input)){
          // lever minimale defaults zodat app niet blijft wachten
          if (String(input).includes('settings.json')) {
            return safeJsonResponse({ year: new Date().getFullYear(), tabs: ["Overzicht","Transacties"], drive:false });
          }
          return safeJsonResponse({}); // generieke lege JSON
        }
        return res;
      }catch(err){
        if (isDataJson(input)) return safeJsonResponse({});
        throw err;
      }
    };
  }

  // 3) Ontgrendel UI: maak klikbaar en haal loaders weg
  function unlock(doc){
    try{
      (doc.getElementById('root')||doc.getElementById('app')||doc.querySelector('main')||doc.body).style.pointerEvents='auto';
      doc.querySelectorAll('[inert]').forEach(el=>el.removeAttribute('inert'));
      const sel='a,button,input,select,textarea,summary,[role="button"],[role="link"],[role="tab"],[onclick],[tabindex]';
      doc.querySelectorAll(sel).forEach(el=>{ try{
        el.disabled=false; el.removeAttribute('disabled');
        const cs=(doc.defaultView||window).getComputedStyle(el);
        if (cs && cs.pointerEvents==='none') el.style.pointerEvents='auto';
      }catch(_){ }});
      const killers=['.overlay','.backdrop','.modal','.scrim','.spinner','.loading','.preloader',
                     '#overlay','#backdrop','#modal','#spinner','#loading','[data-loading]','[data-blocker]','[aria-modal="true"]'];
      killers.forEach(s=>{ try{ doc.querySelectorAll(s).forEach(el=>{ el.style.display='none'; el.style.pointerEvents='none'; el.removeAttribute('inert'); el.removeAttribute('aria-modal'); }); }catch(_){ }});
    }catch(_){}
  }
  function boot(){ unlock(document); }
  if (document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', boot, {once:true}); } else { boot(); }
  setTimeout(boot, 800); setTimeout(boot, 1500); setTimeout(boot, 2500);
})();
</script>

<script defer src="app.js"></script>
  <link <link rel="apple-touch-icon" sizes="180x180" href="../icons/kgb-full-180.png"><meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
<header class="bar">
  <h1>ğŸ’° KGB Finance 2025 â€” Web (Full)</h1>
  <nav class="tabs">
    <button data-tab="dashboard" class="tab active">Dashboard</button>
    <button data-tab="budget" class="tab">Budget</button>
    <button data-tab="invest" class="tab">Beleggingen</button>
    <button data-tab="crypto" class="tab">Crypto</button>
    <button data-tab="agenda" class="tab">Agenda</button>
    <button data-tab="family" class="tab">Familie</button>
    <button data-tab="theme" class="tab">Thema</button>
    <button data-tab="io" class="tab">Export / Import</button>
  </nav>
</header>

<main>
  <section id="dashboard" class="panel active">
    <div class="cards">
      <div class="card"><div class="k">Inkomen</div><div class="v" id="totIncome">0,00</div></div>
      <div class="card"><div class="k">Uitgave</div><div class="v" id="totExpense">0,00</div></div>
      <div class="card"><div class="k">Saldo</div><div class="v ok" id="totSaldo">0,00</div></div>
      <div class="card"><div class="k">Beleggingen (netto)</div><div class="v" id="totInvest">0,00</div></div>
      <div class="card"><div class="k">Crypto (netto)</div><div class="v" id="totCrypto">0,00</div></div>
    </div>
    <div class="chartBar">
      <div class="left">
        <strong>Grafiek:</strong>
        <label><input type="radio" name="ctype" value="line" checked> Lijn</label>
        <label><input type="radio" name="ctype" value="bar"> Balk</label>
        <label><input type="radio" name="ctype" value="pie"> Cirkel</label>
      </div>
      <div class="right">
        <button id="btnDemo">Demo-data</button>
        <button id="btnClear">Alles wissen</button>
      </div>
    </div>
    <canvas id="saldoChart" height="160"></canvas>
  </section>

  <section id="budget" class="panel">
    <h2>ğŸ“‹ Budget</h2>
    <form id="addBudget" class="addForm">
      <input id="b_date" type="date" required />
      <input id="b_cat" type="text" placeholder="Categorie" required />
      <input id="b_desc" type="text" placeholder="Omschrijving" />
      <input id="b_inc" type="number" step="0.01" inputmode="decimal" placeholder="Inkomen">
      <input id="b_exp" type="number" step="0.01" inputmode="decimal" placeholder="Uitgave">
      <button type="submit">â• Toevoegen</button>
    </form>
    <div class="tableWrap">
      <table id="tblBudget" class="grid">
        <thead><tr><th>Datum</th><th>Categorie</th><th>Omschrijving</th><th>Inkomen</th><th>Uitgave</th><th>Saldo</th><th>Acties</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="invest" class="panel">
    <h2>ğŸ’¼ Beleggingen</h2>
    <form id="addInvest" class="addForm">
      <input id="i_date" type="date" required />
      <input id="i_name" type="text" placeholder="Aandeel" required />
      <input id="i_qty" type="number" step="0.0001" inputmode="decimal" placeholder="Aantal" required />
      <input id="i_buy" type="number" step="0.01" inputmode="decimal" placeholder="Aankoop">
      <input id="i_sell" type="number" step="0.01" inputmode="decimal" placeholder="Verkoop">
      <input id="i_div" type="number" step="0.01" inputmode="decimal" placeholder="Dividend">
      <button type="submit">â• Toevoegen</button>
    </form>
    <div class="tableWrap">
      <table id="tblInvest" class="grid">
        <thead><tr><th>Datum</th><th>Aandeel</th><th>Aantal</th><th>Aankoop</th><th>Verkoop</th><th>Dividend</th><th>Winst</th><th>Verlies</th><th>Acties</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="crypto" class="panel">
    <h2>ğŸª™ Crypto</h2>
    <form id="addCrypto" class="addForm">
      <input id="c_date" type="date" required />
      <input id="c_token" type="text" placeholder="Token" required />
      <input id="c_qty" type="number" step="0.0001" inputmode="decimal" placeholder="Aantal" required />
      <input id="c_buy" type="number" step="0.01" inputmode="decimal" placeholder="Aankoop">
      <input id="c_sell" type="number" step="0.01" inputmode="decimal" placeholder="Verkoop">
      <button type="submit">â• Toevoegen</button>
    </form>
    <div class="tableWrap">
      <table id="tblCrypto" class="grid">
        <thead><tr><th>Datum</th><th>Token</th><th>Aantal</th><th>Aankoop</th><th>Verkoop</th><th>Winst</th><th>Verlies</th><th>Acties</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="agenda" class="panel">
    <h2>ğŸ—“ï¸ Agenda</h2>
    <form id="addAgenda" class="addForm">
      <input id="a_date" type="date" required />
      <input id="a_task" type="text" placeholder="Taak" required />
      <input id="a_status" type="text" placeholder="Status" />
      <input id="a_meet" type="text" placeholder="Afspraak" />
      <button type="submit">â• Toevoegen</button>
    </form>
    <div class="tableWrap">
      <table id="tblAgenda" class="grid">
        <thead><tr><th>Datum</th><th>Taak</th><th>Status</th><th>Afspraak</th><th>Acties</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="family" class="panel">
    <h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Familie</h2>
    <p class="muted">Deel deze link met familie. Data blijft per toestel. Delen? Gebruik Export/Import JSON.</p>
  </section>

  <section id="theme" class="panel">
    <h2>ğŸ¨ Thema</h2>
    <div class="themeBox">
      <label>Onderdeel:
        <select id="themeTarget">
          <option value="bg">Achtergrond</option>
          <option value="card">Kaarten/Tabel</option>
          <option value="acc">Accent/Knoppen</option>
          <option value="grid">Rasterlijnen</option>
          <option value="txt">Tekst</option>
        </select>
      </label>
      <div id="swatches" class="swatches"></div>
      <div class="sliders">
        <label>Intensiteit <input id="intensity" type="range" min="50" max="150" value="100"></label>
        <label>Raster <input id="gridIntensity" type="range" min="50" max="150" value="100"></label>
      </div>
      <div class="themeBtns">
        <button id="themeReset">Reset</button>
        <button id="themeSave">Opslaan</button>
      </div>
    </div>
  </section>

  <section id="io" class="panel">
    <h2>â¬‡ï¸ Export / â¬†ï¸ Import</h2>
    <div class="io-actions">
      <button id="btnExport">Export JSON</button>
      <label class="fileLabel">Import JSON <input id="fileImport" type="file" accept="application/json"></label>
      <button id="btnReset" class="danger">Reset (alles wissen)</button>
    </div>
    <p class="muted">PWA â€“ werkt offline na 1Ã— laden.</p>
  </section>
</main>

<footer><small>Â© KGB Finance 2025</small></footer>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => void 0 && navigator.serviceWorker.register('./service-worker.js'));
}
</script>
<script>if('serviceWorker' in navigator){void 0 && navigator.serviceWorker.register('./sw.js',{scope:'./'});}</script></body>
</html>
