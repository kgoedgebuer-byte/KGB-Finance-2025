<!doctype html>
<html lang="nl">
<head>

<style id="kgb-click-proxy-style">
  #kgb-proxy-tip{position:fixed;left:10px;bottom:10px;z-index:2147483647;background:#111;color:#0f0;
    border:1px solid #0f0;border-radius:10px;padding:6px 8px;font:12px/1 -apple-system,Segoe UI,Arial,sans-serif}
</style>
<script id="kgb-click-proxy">
(function(){
  if (window.__KGB_CLICK_PROXY__) return; window.__KGB_CLICK_PROXY__=true;

  function unfreeze(){
    try{
      document.querySelectorAll('[inert]').forEach(el=>el.removeAttribute('inert'));
      document.querySelectorAll('dialog[open]').forEach(d=>{ try{ d.close(); }catch(_){ } });
      document.querySelectorAll('[aria-modal="true"]').forEach(el=>el.removeAttribute('aria-modal'));
      // maak controls bruikbaar
      const sel = 'a,button,input,select,textarea,summary,[role="button"],[role="link"],[role="tab"],[onclick],[tabindex]';
      document.querySelectorAll(sel).forEach(el=>{ try{
        el.disabled=false; el.removeAttribute('disabled');
        const cs=getComputedStyle(el); if(cs.pointerEvents==='none') el.style.pointerEvents='auto';
      }catch(_){ }});
      (document.getElementById('root')||document.getElementById('app')||document.querySelector('main')||document.body).style.pointerEvents='auto';
    }catch(_){}
  }

  function looksOverlay(el, vw, vh){
    try{
      if (!el || el===document.documentElement || el===document.body) return false;
      if (/kgb-proxy-tip/.test(el.id||'')) return false;
      const r = el.getBoundingClientRect(); const area = Math.max(0,r.width)*Math.max(0,r.height);
      const ratio = area/Math.max(1,vw*vh);
      const cls = (el.className||'') + ' ' + (el.id||'');
      return ratio>=0.90 ||
             /(overlay|backdrop|modal|scrim|spinner|loading|blocker)/i.test(cls);
    }catch(_){ return false; }
  }

  // Vind eerste echte target ONDER overlays
  function findTarget(x,y){
    const vw=innerWidth||1, vh=innerHeight||1;
    const stack = (document.elementsFromPoint? document.elementsFromPoint(x,y) : []).filter(Boolean);
    for (const el of stack){
      if (looksOverlay(el, vw, vh)) continue;
      // eerste duidelijke interactief?
      if (/^(A|BUTTON|INPUT|SELECT|TEXTAREA|SUMMARY|LABEL)$/i.test(el.tagName)) return el;
      const role = (el.getAttribute('role')||'').toLowerCase();
      if (/(button|link|tab)/.test(role)) return el;
      if (el.onclick || el.getAttribute('onclick')) return el;
    }
    // anders neem element op plek
    return document.elementFromPoint(x,y);
  }

  function proxy(ev){
    try{
      unfreeze();
      const x = ev.clientX, y = ev.clientY;
      // zet bovenliggende covers tijdelijk uit om juiste target te vinden
      const disabled=[];
      const stack = (document.elementsFromPoint? document.elementsFromPoint(x,y) : []).filter(Boolean);
      const vw=innerWidth||1, vh=innerHeight||1;
      for (const el of stack){
        if (looksOverlay(el, vw, vh)){
          const prev = el.style.pointerEvents;
          if (prev!=='none'){ el.style.pointerEvents='none'; disabled.push([el,prev]); }
        }
      }
      const tgt = findTarget(x,y);
      // herstel covers
      for (const [el,val] of disabled){ el.style.pointerEvents = val || ''; }

      if (tgt && tgt !== ev.target){
        // voorkom dat overlay het event pakt
        ev.stopPropagation(); ev.preventDefault();
        // focus en klik onderliggend
        try{ tgt.focus({preventScroll:true}); }catch(_){}
        try{
          const me = new MouseEvent(ev.type, ev);
          tgt.dispatchEvent(me);
          if (ev.type==='click' && tgt.click) tgt.click();
        }catch(_){}
      }
    }catch(_){}
  }

  // Capture alle pointer/mouse events en proxy indien nodig
  ['pointerdown','pointerup','click','mousedown','mouseup','touchend'].forEach(t=>{
    window.addEventListener(t, proxy, true); // capture
  });

  // een paar keer automatisch ontgrendelen
  function auto(){ unfreeze(); setTimeout(unfreeze,150); setTimeout(unfreeze,400); setTimeout(unfreeze,900); }
  if (document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', auto, {once:true}); } else { auto(); }

  // klein tipje
  if (!document.getElementById('kgb-proxy-tip')){
    const tip=document.createElement('div'); tip.id='kgb-proxy-tip';
    tip.textContent='Klik-proxy actief ‚Äî overlays worden genegeerd.';
    document.body.appendChild(tip);
    setTimeout(()=>{ try{ tip.remove(); }catch(_){ } }, 3500);
  }
})();
</script>

  <link rel="stylesheet" href="../common/force_click.css?v=1764853340">










<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>KGB Finance 2025 ‚Äî Budget</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#7c9cf5">
  <link rel="icon" href="icons/icon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="styles.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="app.js"></script>
  <link <link rel="apple-touch-icon" sizes="180x180" href="../icons/kgb-budget-180.png">
  <link rel="stylesheet" href="../common/sync_embed.css">
  <link rel="stylesheet" href="../common/ui_fix.css">
  <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
<header class="bar">
  <h1>üí∞ KGB Finance 2025 ‚Äî Budget</h1>
  <nav class="tabs">
    <button data-tab="dashboard" class="tab active">Dashboard</button>
    <button data-tab="budget" class="tab">Budget</button>
    <button data-tab="theme" class="tab">Thema</button>
    <button data-tab="io" class="tab">Export / Import</button>
  </nav>
</header>

<main>
  <section id="dashboard" class="panel active">
    <div class="cards">
      <div class="card"><div class="k">Inkomen</div><div class="v" id="totIncome">0,00</div></div>
      <div class="card"><div class="k">Uitgave</div><div class="v" id="totExpense">0,00</div></div>
      <div class="card"><div class="k">Saldo</div><div class="v ok" id="totSaldo">0,00</div></div>
    </div>

    <div class="chartBar">
      <div class="left">
        <strong>Grafiek:</strong>
        <label><input type="radio" name="ctype" value="line" checked> Lijn</label>
        <label><input type="radio" name="ctype" value="bar"> Balk</label>
        <label><input type="radio" name="ctype" value="pie"> Cirkel</label>
      </div>
      <div class="right">
        <button id="btnDemo">Demo-data</button>
        <button id="btnClear">Refresh</button>
      </div>
    </div>
    <canvas id="saldoChart" height="160"></canvas>
  </section>

  <section id="budget" class="panel">
    <h2>üìã Budget</h2>
    <form id="addBudget" class="addForm">
      <input id="b_date" type="date" required />
      <input id="b_cat" type="text" placeholder="Categorie" required />
      <input id="b_desc" type="text" placeholder="Omschrijving" />
      <input id="b_inc" type="number" step="0.01" inputmode="decimal" placeholder="Inkomen">
      <input id="b_exp" type="number" step="0.01" inputmode="decimal" placeholder="Uitgave">
      <button type="submit">‚ûï Toevoegen</button>
    </form>

    <div class="tableWrap">
      <table id="tblBudget" class="grid">
        <thead>
          <tr><th>Datum</th><th>Categorie</th><th>Omschrijving</th><th>Inkomen</th><th>Uitgave</th><th>Saldo (loopt)</th><th>Acties</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="theme" class="panel">
    <h2>üé® Thema</h2>
    <div class="themeBox">
      <label>Onderdeel:
        <select id="themeTarget">
          <option value="bg">Achtergrond</option>
          <option value="card">Kaarten/Tabel</option>
          <option value="acc">Accent/Knoppen</option>
          <option value="grid">Rasterlijnen</option>
          <option value="txt">Tekst</option>
        </select>
      </label>
      <div id="swatches" class="swatches"></div>
      <div class="sliders">
        <label>Intensiteit <input id="intensity" type="range" min="50" max="150" value="100"></label>
        <label>Raster <input id="gridIntensity" type="range" min="50" max="150" value="100"></label>
      </div>
      <div class="themeBtns">
        <button id="themeReset">Reset</button>
        <button id="themeSave">Opslaan</button>
      </div>
    </div>
  </section>

  <section id="io" class="panel">
    <h2>‚¨áÔ∏è Export / ‚¨ÜÔ∏è Import</h2>
    <div class="io-actions">
      <button id="btnExport">Export JSON</button>
      <label class="fileLabel">Import JSON <input id="fileImport" type="file" accept="application/json"></label>
      <button id="btnReset" class="danger">Reset (alles wissen)</button>
    </div>
    <p class="muted">PWA ‚Äì werkt offline na 1√ó laden.</p>
  </section>
</main>

<footer><small>¬© KGB Finance 2025</small></footer>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => void 0 && navigator.serviceWorker.register('./service-worker.js'));
}
</script>
<script>if('serviceWorker' in navigator){void 0 && navigator.serviceWorker.register('./sw.js',{scope:'./'});}</script>
  <script src="../common/sync_embed.js" defer></script>
  <script src="../common/kgb_year_dropdown.js" defer></script>
  <script src="../common/drive_autopull.js"></script>
  <script src="../common/ui_fix.js"></script>
  <script defer src="../common/pwa_hotfix.js"></script>
  <script defer src="../common/layout_fix.js"></script>
  <script defer src="../common/ui_rescue.js"></script>




















</body>
</html>
