<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>KGB Finance 2025 â€” Budget</title>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#7c9cf5">
  <link rel="icon" href="icons/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">

  <link rel="stylesheet" href="styles.css?v=20251219165610" />

  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js?v=20251219165610"></script>
  <script defer src="app.js?v=20251219165610"></script>
  <script defer src="../common/kgb_year_dropdown.js?v=20251219165610"></script>
</head>

<body>
<header class="bar">
  <h1>ðŸ’° KGB Finance 2025 â€” Budget</h1>

  <nav class="tabs" aria-label="Navigatie">
    <button type="button" data-tab="dashboard" class="tab active">Dashboard</button>
    <button type="button" data-tab="budget" class="tab">Budget</button>
    <button type="button" data-tab="theme" class="tab">Thema</button>

    <span id="yearMount" style="margin-left:10px;"></span>
  </nav>
</header>

<main>
  <!-- DASHBOARD -->
  <section id="dashboard" class="panel active">
    <div class="cards">
      <div class="card"><div class="k">Inkomen</div><div class="v" id="totIncome">0,00</div></div>
      <div class="card"><div class="k">Uitgave</div><div class="v" id="totExpense">0,00</div></div>
      <div class="card"><div class="k">Saldo</div><div class="v ok" id="totSaldo">0,00</div></div>
    </div>

    <div class="chartBar">
      <div class="left">
        <strong>Grafiek:</strong>
        <label><input type="radio" name="ctype" value="line" checked> Lijn</label>
        <label><input type="radio" name="ctype" value="bar"> Balk</label>
        <label><input type="radio" name="ctype" value="pie"> Cirkel</label>
      </div>
      <div class="right"></div>
    </div>

    <canvas id="saldoChart" height="160"></canvas>
  </section>

  <!-- BUDGET -->
  <section id="budget" class="panel">
    <h2>ðŸ“‹ Budget</h2>

    <form id="addBudget" class="addForm" autocomplete="off">
      <input id="b_date" type="date" required />
      <input id="b_cat" type="text" placeholder="Categorie" required />
      <input id="b_desc" type="text" placeholder="Omschrijving" />
      <input id="b_inc" type="number" step="0.01" inputmode="decimal" placeholder="Inkomen">
      <input id="b_exp" type="number" step="0.01" inputmode="decimal" placeholder="Uitgave">
      <button type="submit">âž• Toevoegen</button>
    </form>

    <div class="tableWrap">
      <table id="tblBudget" class="grid">
        <thead>
          <tr>
            <th>Datum</th>
            <th>Categorie</th>
            <th>Omschrijving</th>
            <th>Inkomen</th>
            <th>Uitgave</th>
            <th>Saldo (loopt)</th>
            <th>Acties</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- THEMA -->
  <section id="theme" class="panel">
    <h2>ðŸŽ¨ Thema</h2>

    <div class="themeBox">
  <label>Jaar:
    <select id="yearSelect"></select>
  </label>

  <label>Onderdeel:
    <select id="themeTarget">
      <option value="bg">Achtergrond</option>
<option value="card">Kaarten/Tabel</option>
<option value="acc">Accent/Knoppen</option>
<option value="grid">Rasterlijnen</option>
<option value="txt">Tekst</option>
    </select>
  </label>

  <div id="swatches" class="swatches"></div>

  <div class="sliders">
    <label>Intensiteit <input id="intensity" type="range" min="50" max="150" value="100"></label>
    <label>Raster <input id="gridIntensity" type="range" min="50" max="150" value="100"></label>
  </div>

  <div class="themeBtns">
    <button id="themeReset" type="button">Reset</button>
    <button id="themeSave" type="button">Opslaan</button>
  </div>
</div>
  </section>

<!-- KGB_COLOR_PICKER_UI v1 -->
<div class="kgb-theme-picker card" style="margin-top:12px;">
  <div class="row" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
    <label style="display:flex;gap:8px;align-items:center;">
      <span>Onderdeel:</span>
      <select id="kgbTarget" style="min-width:180px;">
        <option value="bg">Achtergrond</option>
        <option value="card">Kaarten/Tabel</option>
        <option value="acc">Accent/Knoppen</option>
        <option value="grid">Rasterlijnen</option>
        <option value="txt">Tekst</option>
      </select>
    </label>
    <label style="display:flex;gap:8px;align-items:center;">
      <span>Kleur:</span>
      <input id="kgbColor" type="color" value="#7c9cf5" />
    </label>
    <button id="kgbApply" type="button">Toepassen</button>
    <button id="kgbSave" type="button">Opslaan</button>
    <button id="kgbReset" type="button">Reset</button>
  </div>

  <div id="kgbSwatches" class="swatches" style="margin-top:10px;"></div>
</div>

<script>
/* KGB_COLOR_PICKER_LOGIC v1 */
(() => {
  const THEME_KEY = "kgb_finance_theme_v1";
  const pastel = ["#A0C4FF","#BDB2FF","#FFC6FF","#9BF6FF","#FDFFB6","#CAFFBF","#FFADAD","#FFD6A5","#E4C1F9","#CDEAC0","#B9FBC0","#FFD5C2","#F7DAD9","#E2ECE9","#E6CBA8","#E4C6A1","#E8AEB7","#A0CED9","#E8D7FF","#A3D5D3","#D9E8E3","#FFF3B0","#FFCFD2","#F1E3FF","#C8E7FF","#E3F8FF","#FFEEE8","#FFE3E3","#E5FFFB","#F6E6FF","#F9D8D6","#D7F9F1","#F8E8C6","#FBE7E1","#E0F7FA","#E8F5E9","#FFEBEE","#FFFDE7","#EDE7F6","#E3F2FD","#FCE4EC","#F3E5F5","#FFECB3","#D1C4E9","#BBDEFB","#C8E6C9","#F0F4C3","#DCEDC8"];
  const def = {bg:"#f5f7ff",card:"#ffffff",acc:"#7c9cf5",txt:"#0f172a",grid:"#e2e8f0",intensity:100,gridIntensity:100};
  const $ = (s) => document.querySelector(s);

  function colToRgb(hex){hex=(hex||"").replace('#',''); if(hex.length===3) hex=hex.split('').map(x=>x+x).join(''); const n=parseInt(hex,16); return {r:(n>>16)&255,g:(n>>8)&255,b:n&255};}
  function adjust(hex,f){const {r,g,b}=colToRgb(hex); const adj=(v)=>Math.max(0,Math.min(255, Math.round(v*(f/100)))); return `rgb(${adj(r)}, ${adj(g)}, ${adj(b)})`;}
  function applyTheme(t){
    const root = document.documentElement;
    root.style.setProperty('--bg',   adjust(t.bg,   t.intensity||100));
    root.style.setProperty('--card', adjust(t.card, t.intensity||100));
    root.style.setProperty('--acc',  adjust(t.acc,  t.intensity||100));
    root.style.setProperty('--grid', adjust(t.grid, t.gridIntensity||100));
    root.style.setProperty('--txt',  t.txt || "#0f172a");
  }
  function load(){ try { return JSON.parse(localStorage.getItem(THEME_KEY)||"null") || {...def}; } catch(e){ return {...def}; } }
  function save(t){ localStorage.setItem(THEME_KEY, JSON.stringify(t)); }

  function setPartColor(t){
    const part = $("#kgbTarget").value;
    const col  = $("#kgbColor").value;
    if (part === "bg") t.bg = col;
    else if (part === "card") t.card = col;
    else if (part === "acc") t.acc = col;
    else if (part === "grid") t.grid = col;
    else t.txt = col;
    applyTheme(t);
  }

  function buildSwatches(t){
    const box = $("#kgbSwatches");
    if (!box) return;
    box.innerHTML = "";
    pastel.forEach(c => {
      const b = document.createElement("button");
      b.type = "button";
      b.className = "swatch";
      b.style.background = c;
      b.title = c;
      b.addEventListener("click", () => {
        $("#kgbColor").value = c;
        setPartColor(t);
      });
      box.appendChild(b);
    });
  }

  window.addEventListener("DOMContentLoaded", () => {
    const t = load();
    applyTheme(t);
    buildSwatches(t);

    $("#kgbApply").addEventListener("click", () => setPartColor(t));
    $("#kgbSave").addEventListener("click", () => { save(t); alert("Thema opgeslagen."); });
    $("#kgbReset").addEventListener("click", () => {
      Object.assign(t, def);
      applyTheme(t);
      $("#kgbColor").value = t.acc;
      buildSwatches(t);
    });
  });
})();
</script>

</main>

<footer><small>Â© KGB Finance 2025</small></footer>

<!-- Tabs: ALWAYS work, even if app.js is broken -->
<script>
(function () {
  const tabs = Array.from(document.querySelectorAll('.tabs .tab[data-tab]'));
  const panels = Array.from(document.querySelectorAll('main .panel'));

  function setActive(name) {
    tabs.forEach(b => b.classList.toggle('active', b.dataset.tab === name));
    panels.forEach(p => p.classList.toggle('active', p.id === name));
  }

  tabs.forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      setActive(btn.dataset.tab);
    });
  });

  // ensure initial state is correct
  const initial = (tabs.find(b => b.classList.contains('active')) || tabs[0])?.dataset?.tab || 'dashboard';
  setActive(initial);
})();
</script>

<!-- Service worker (laat staan als je PWA wil) -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    // SW disabled for budget-v2 (cache issues).catch(()=>{});
  });
}
</script>

</body>
</html>
