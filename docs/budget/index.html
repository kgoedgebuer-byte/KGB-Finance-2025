<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>KGB Finance 2025 â€” Budget</title>

  <link rel="manifest" href="/budget/manifest.webmanifest">
  <meta name="theme-color" content="#7c9cf5">

  <link rel="icon" href="/budget/icons/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/kgb-budget-180.png">

  <link rel="stylesheet" href="/budget/styles.css" />
  <link rel="stylesheet" href="/common/sync_embed.css" />

  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="/budget/app.js"></script>
  <script defer src="/common/kgb_year_dropdown.js"></script>

  <!-- Tijdelijke cache-clean (gsm) -->
  <script>
    // 1x SW unregister + caches clear (alleen als je ?swreset=1 toevoegt)
    (function () {
      const params = new URLSearchParams(location.search);
      if (!params.has('swreset')) return;

      (async () => {
        try {
          if ('serviceWorker' in navigator) {
            const regs = await navigator.serviceWorker.getRegistrations();
            await Promise.all(regs.map(r => r.unregister()));
          }
          if ('caches' in window) {
            const keys = await caches.keys();
            await Promise.all(keys.map(k => caches.delete(k)));
          }
          // herlaad zonder parameter
          const url = new URL(location.href);
          url.searchParams.delete('swreset');
          location.replace(url.toString());
        } catch (e) {
          console.log('SW reset failed', e);
        }
      })();
    })();
  </script>
</head>

<body>
<header class="bar">
  <h1>ðŸ’° KGB Finance 2025 â€” Budget</h1>

  <nav class="tabs">
    <button data-tab="dashboard" class="tab active">Dashboard</button>
    <button data-tab="budget" class="tab">Budget</button>
    <button data-tab="theme" class="tab">Thema</button>

    <!-- Jaar dropdown komt hier -->
    <span id="yearMount" class="yearMount"></span>
  </nav>
</header>

<main>
  <section id="dashboard" class="panel active">
    <div class="cards">
      <div class="card"><div class="k">Inkomen</div><div class="v" id="totIncome">0,00</div></div>
      <div class="card"><div class="k">Uitgave</div><div class="v" id="totExpense">0,00</div></div>
      <div class="card"><div class="k">Saldo</div><div class="v ok" id="totSaldo">0,00</div></div>
    </div>

    <div class="chartBar">
      <div class="left">
        <strong>Grafiek:</strong>
        <label><input type="radio" name="ctype" value="line" checked> Lijn</label>
        <label><input type="radio" name="ctype" value="bar"> Balk</label>
        <label><input type="radio" name="ctype" value="pie"> Cirkel</label>
      </div>
      <div class="right">
        <button id="btnDemo">Demo-data</button>
        <button id="btnClear">Refresh</button>
      </div>
    </div>

    <canvas id="saldoChart" height="160"></canvas>
  </section>

  <section id="budget" class="panel">
    <h2>ðŸ“‹ Budget</h2>

    <form id="addBudget" class="addForm">
      <input id="b_date" type="date" required />
      <input id="b_cat" type="text" placeholder="Categorie" required />
      <input id="b_desc" type="text" placeholder="Omschrijving" />
      <input id="b_inc" type="number" step="0.01" inputmode="decimal" placeholder="Inkomen">
      <input id="b_exp" type="number" step="0.01" inputmode="decimal" placeholder="Uitgave">
      <button type="submit">âž• Toevoegen</button>
    </form>

    <div class="tableWrap">
      <table id="tblBudget" class="grid">
        <thead>
          <tr>
            <th>Datum</th>
            <th>Categorie</th>
            <th>Omschrijving</th>
            <th>Inkomen</th>
            <th>Uitgave</th>
            <th>Saldo (loopt)</th>
            <th>Acties</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="theme" class="panel">
    <h2>ðŸŽ¨ Thema</h2>

    <div class="themeBox">
      <label>Onderdeel:
        <select id="themeTarget">
          <option value="bg">Achtergrond</option>
          <option value="card">Kaarten/Tabel</option>
          <option value="acc">Accent/Knoppen</option>
          <option value="grid">Rasterlijnen</option>
          <option value="txt">Tekst</option>
        </select>
      </label>

      <div id="swatches" class="swatches"></div>

      <div class="sliders">
        <label>Intensiteit <input id="intensity" type="range" min="50" max="150" value="100"></label>
        <label>Raster <input id="gridIntensity" type="range" min="50" max="150" value="100"></label>
      </div>

      <div class="themeBtns">
        <button id="themeReset" type="button">Reset</button>
        <button id="themeSave" type="button">Opslaan</button>
      </div>
    </div>
  </section>

  <!-- reset sectie blijft, maar geen export/import -->
  <section id="io" class="panel">
    <div class="io-actions">
      <button id="btnReset" class="danger" type="button">Reset (alles wissen)</button>
    </div>
    <p class="muted">PWA â€“ werkt offline na 1Ã— laden.</p>
  </section>
</main>

<footer><small>Â© KGB Finance 2025</small></footer>

<script>
  // Service worker: laat 1 variant toe. (als jij sw.js gebruikt, zet service-worker.js uit)
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      // Kies 1 van de twee. Ik hou sw.js aan:
      navigator.serviceWorker.register('/budget/sw.js', { scope: '/budget/' }).catch(() => {});
    });
  }
</script>

</body>
</html>
